#include <iostream>
#include <string>
#include <fstream>
#include "Trie.h"
#include <string.h>
#include "Lexer.h"
#include "Token.h"
#include <sstream>
#define numops 22

using namespace std;

string ops[] = {"ADD", "SUB", "MULT", "DIV", "REM", "DUP", "AND", "OR", "NOT", "ISEQ", "ISNE", 
"ISGT", "ISGE", "ISLT", "ISLE", "LOADL", "LOADV", "STOREV", "JUMP", "JUMPF", "PRINT", "PRINTLN"
"PRINTS"};

string codes[] = {"A0", "A1", "A3", "A4", "A5", "B0", "B1", "B2", "B3", "B4", "B5", "B6", "B7",
"B8", "C0", "C1", "C2", "D0", "D1", "E0", "E1", "E2"};

string hexcode = "CAFEBE";

Trie *makeInsTable()
{
 Trie *table = new Trie();
 for(int i = 0; i < numops; i++)
 {
  table->put(ops[i], codes[i]);
  cout << table->get(ops[i]) << endl;
 }
 return table;
}

bool isLabel(string s)
{
 return s[s.size() - 1] == ':';
}

string intToHexString(int i)
{
 stringstream stream;
 stream << hex << i;
 return stream.str();
}

int main(int argc, char** argv)
{
 //init tables
 string program[255];
 program[0] = hexcode;
 Trie *labelmap = new Trie();
 //Trie *argmap = new Trie();
 //Trie *instable = makeInsTable();
 
 //parse cmdline options
 for(int i = 1; i < argc; i++)
 {
  if(!strcmp(argv[i], "-h"))
  {
   continue;
  }

  if(!strcmp(argv[i], "-i"))
  {
   continue;
  }

  if(!strcmp(argv[i], "-l"))
  {
   continue;
  }

  if(!strcmp(argv[i], "-a"))
  {
   continue;
  }

  if(!strcmp(argv[i], "p"))
  {
   continue;
  }
  //pseudo else condition b/c of continues
  fstream fin;
  fin.open(argv[i], ios::in);
  istream& i = fin;
  Lexer *l = new Lexer(i);
  Token t = l->nextToken();
  int line;
  while(t.getType() != Token::ENDOFFILE)
  {
   string prog;
   line = t.getLine();
   string next = t.getLexeme();
   if(isLabel(next))
   {
    if(labelmap->get(next) != "")
    {
     cout << "label declared twice" << endl;
     return 1;
    }
    else
    {
     labelmap->put(next, intToHexString(token.getLine())); 
     prog += labelmap->get(next);
    } 
   }
   else
   {
    prog += "00"
   }
   t = l->nextToken();
  }
 }
 
 return 0;
}
